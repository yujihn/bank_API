# REST API банковского сервиса

## Общее описание проекта

Это серверное приложение, предоставляющее клиентам полноценный доступ к банковским услугам посредством REST API. Сервис обеспечивает безопасное и надежное взаимодействие с банковскими продуктами, включая управление пользователями, счетами, картами, переводами, кредитами и аналитическими отчетами.

## Cтек технологий

- **Язык программирования**: Go 1.24.2
- **Маршрутизация**: `github.com/gorilla/mux`
- **База данных**: PostgreSQL 17 с расширением pgcrypto для криптографических операций
- **Драйвер БД**: `github.com/lib/pq` или `pgx`
- **Аутентификация**: JWT (`github.com/golang-jwt/jwt/v5`)
- **Логирование**: `github.com/sirupsen/logrus`
- **Шифрование и хеширование**: bcrypt, HMAC-SHA256, PGP
- **Email-уведомления**: `gopkg.in/gomail.v2`
- **Обработка XML**: `github.com/beevik/etree`
- **Планировщик задач**: встроенные средства `time.Ticker` или сторонние библиотеки cron

## Основные функциональные возможности

### Управление пользователями
- Регистрация новых пользователей с уникальными email и именем пользователя
- Аутентификация с выдачей JWT-токена, действительного 24 часа

### Работа со счетами
- Создание и управление банковскими счетами
- Переводы между счетами
- Пополнение и списание денежных средств со счетов

### Банковские карты
- Выпуск виртуальных карт с безопасным хранением данных:
  - Номер карты сгенерирован по алгоритму Луна
  - Номер и срок действия хранятся в зашифрованном виде (PGP)
  - CVV — bcrypt-хеш
- Просмотр данных карты владельцем
- Проведение платежей с карты

### Работа с кредитами
- Оформление кредитных договоров с аннуитетной схемой платежей
- Генерация графика платежей
- Автоматическое списание платежей по расписанию
- Штрафы за просрочку (добавление +10% к сумме)

### Аналитические данные
- Анализ доходов и расходов за месяц
- Оценка кредитной нагрузки
- Прогнозирование баланса на срок до 365 дней

## Структура API
```
| Метод  | Путь                   | Описание                        | Доступ    |
|--------|------------------------|---------------------------------|-----------|
| POST   | /register              | Регистрация нового пользователя | Публичный |
| POST   | /login                 | Вход и получение JWT-токена     | Публичный |
| POST   | /accounts              | Создать новый счет              | JWT       |
| PATCH  | /accounts/{id}/balance | Пополнение или списание         | JWT       |
| POST   | /transfer              | Перевод между счетами           | JWT       |
| POST   | /cards                 | Выпуск виртуальной карты        | JWT       |
| GET    | /cards/{id}            | Просмотр данных карты           | JWT       |
| POST   | /payments              | Оплата с карты                  | JWT       |
| POST   | /credits               | Оформление кредита              | JWT       |
| GET    | /credits/{id}/schedule | График платежей по кредиту      | JWT       |
| GET    | /analytics             | Аналитические отчеты            | JWT       |
| GET    | /accounts/{id}/predict | Прогноз баланса                 | JWT       |
```
## Модель данных
```
| Таблица               | Ключевые поля                                                                              |
|-----------------------|--------------------------------------------------------------------------------------------|
| users                 | id (PK), email (UNIQUE), username (UNIQUE), password_hash, created_at                      |
| accounts              | id, user_id (FK), balance, currency='RUB', created_at                                      |
| cards                 | id, user_id (FK), card_number (bytea PGP), expire (bytea PGP), cvv_hash, created_at        |
| transactions          | id, account_id (FK), amount, type [DEBIT/CREDIT], status, created_at                       |
| credits               | id, account_id (FK), principal, interest_rate, term_months, start_date, status, created_at |
| payment_schedules     | id, credit_id (FK), due_date, amount, paid, created_at                                     |
```
## Безопасность

- **Пароли**: хеширование с помощью bcrypt (cost 12+)
- **JWT**: подпись HMAC-SHA256, срок действия — 24 часа
- **Данные карт**:
  - Номер и срок действия шифруются с помощью PGP
  - CVV хранится в bcrypt-хеше
  - Целостность данных обеспечивается HMAC-SHA256
- **Авторизация**: осуществляется проверкой владения ресурсами по userID

## Внешние интеграции

- **ЦБ РФ**: подключение к SOAP API для получения ключевой ставки
  - URL: `https://www.cbr.ru/DailyInfoWebServ/DailyInfo.asmx`
  - Обработка XML-ответов с помощью etree
- **SMTP**: отправка email-уведомлений о регистрации, операциях и просрочках платежей

## Планировщик задач

Автоматическое выполнение задач каждые 12 часов:
- Проверка графика платежей на текущий день и выявление просроченных
- Попытка списания платежных сумм
- В случае недостатка средств — начисление штрафа (+10%)

## Нефункциональные требования

- **Производительность**: до 100 RPS
- **Логирование**: JSON, уровни DEBUG/INFO/WARN/ERROR
- **Тестовое покрытие**: не менее 70%
- **Документация API**: OpenAPI 3 (Swagger UI)
- **CI/CD**: автоматическая сборка, тестирование и деплой Docker-образов
- **Валюта**: только RUB
